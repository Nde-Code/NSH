name: Full NSH API integration & Health check

on:
  schedule:
    - cron: '27 1 3,15,23 * *'
  workflow_dispatch:

jobs:
  api-testing:
    runs-on: ubuntu-latest
    steps:
    
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: Run full API test suite
        env:
          ADMIN_KEY: ${{ secrets.ADMIN_KEY }}
        run: |
          python3 health_check_action.py \
            --link "https://test.domain.com" \
            --remote "https://nsh.nde-code.workers.dev/" \
            --max-url-length 2000 \
            --timeout 10 \
            --delay 5
